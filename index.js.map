{"version":3,"file":"index.js","mappings":"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","sources":["webpack:///./src/bond-row-template.pug","webpack:///./src/index-root-template.pug","webpack:///webpack/bootstrap","webpack:///webpack/runtime/compat get default export","webpack:///webpack/runtime/define property getters","webpack:///webpack/runtime/hasOwnProperty shorthand","webpack:///external var \"Vue\"","webpack:///./src/report-row-extensions.ts","webpack:///./src/bond-row-component.ts","webpack:///./src/coupon-values.ts","webpack:///./src/storageUtil.ts","webpack:///./src/load-report.ts","webpack:///./src/night-mode.ts","webpack:///./src/settings.ts","webpack:///./src/view-model.ts","webpack:///./src/index.ts"],"sourcesContent":["<tr v-bind:class=\"rowClass\"><td class=\"text-nowrap\"><a v-bind:href=\"moexUrl\" target=\"_blank\">{{ row.name }}</a><span class=\"text-success\" v-if=\"row.inABI\"> *</span><sup class=\"text-success\" v-if=\"row.inCBHY\"> вд</sup><sup class=\"text-danger\" v-if=\"row.isQualOnly\"> кв</sup></td><td class=\"d-none d-md-table-cell text-center\"><span v-bind:class=\"listLevelBadgeClass\">{{ listLevelName }}</span></td><td>{{ ratingText }}</td><td class=\"d-none d-sm-table-cell\">{{ row.maturityDate }}\n<sup class=\"text-alpha-60\" v-if=\"row.hasFutureAmort\">A</sup></td><td class=\"d-none d-md-table-cell text-right\">{{ row.waprice }}</td><td class=\"text-nowrap text-right\"><span class=\"text-danger\" v-if=\"showCouponStar\">**</span>\n<sup class=\"text-danger\" v-if=\"showCouponHint\">{{ couponHintText }} </sup>\n{{ couponValueText }}</td><td class=\"text-right\"><template v-if=\"row.closeYield\"><sup class=\"text-danger\" v-if=\"row.hasOffer\">оф</sup>\n<strong>{{ row.closeYield }} </strong></template><a v-else-if=\"row.infoUrl\" target=\"_blank\" v-bind:href=\"row.infoUrl\">Инфо</a></td></tr>","<div class=\"container\"><div class=\"row no-gutters mt-2\"><div class=\"col-lg-4\"><div class=\"card mb-2 mr-lg-2\"><div class=\"card-header bg-transparent border-bottom-0\" style=\"cursor: pointer\" v-bind:class=\"{ collapsed: collapseForm }\" data-toggle=\"collapse\" data-target=\"#bond-finder-form-collapse\">Настройки<svg class=\"bond-finder-collapse-icon\" viewBox=\"0 0 24 24\"><path d=\"M16.59 8.59L12 13.17 7.41 8.59 6 10l6 6 6-6z\"></path><path d=\"M0 0h24v24H0z\" fill=\"none\"></path></svg></div><div class=\"collapse\" id=\"bond-finder-form-collapse\" v-bind:class=\"{ show: !collapseForm }\"><div class=\"card-body pt-2\"><div class=\"form-group form-row\"><select class=\"form-control custom-select\" v-model=\"settings.rub\"><option v-bind:value=\"true\">В рублях</option><option v-bind:value=\"false\">В валюте / Замещающие</option></select></div><div class=\"form-group form-row flex-nowrap mb-2\" v-show=\"settings.rub\"><div class=\"form-check form-check-inline\"><input class=\"form-check-input\" type=\"checkbox\" value=\"1\" id=\"form_sector1\" v-model=\"settings.sector1\"><label class=\"form-check-label\" for=\"form_sector1\">ОФЗ</label></div><div class=\"form-check form-check-inline\"><input class=\"form-check-input\" type=\"checkbox\" value=\"2\" id=\"form_sector2\" v-model=\"settings.sector2\"><label class=\"form-check-label\" for=\"form_sector2\">Муни</label></div><div class=\"form-check form-check-inline\"><input class=\"form-check-input\" type=\"checkbox\" value=\"3\" id=\"form_sector3\" v-model=\"settings.sector3\"><label class=\"form-check-label\" for=\"form_sector3\">Корп</label></div></div><div class=\"form-group form-row flex-nowrap mb-2\" v-show=\"!settings.rub\"><div class=\"form-check form-check-inline\"><input class=\"form-check-input\" type=\"checkbox\" id=\"form_gov_only\" v-model=\"settings.govOnly\"><label class=\"form-check-label\" for=\"form_gov_only\">Только госдолг</label></div></div><div class=\"form-group form-row flex-nowrap\"><div class=\"form-check form-check-inline\"><input class=\"form-check-input\" type=\"checkbox\" id=\"form_high_risk\" v-model=\"settings.highRisk\"><label class=\"form-check-label\" for=\"form_high_risk\" title=\"Сектор компаний повышенного инвестиционного риска\">ПИР</label></div><div class=\"form-check form-check-inline\"><input class=\"form-check-input\" type=\"checkbox\" id=\"form_qual\" v-model=\"settings.qual\"><label class=\"form-check-label\" for=\"form_qual\">Квал</label></div><div class=\"form-check form-check-inline\"><input class=\"form-check-input\" type=\"checkbox\" id=\"form_offer\" v-model=\"settings.offer\"><label class=\"form-check-label\" for=\"form_offer\">Офер</label></div></div><div class=\"form-group form-row\"><label>Погашение (от - до)</label><div class=\"input-group\"><select class=\"form-control custom-select\" v-model=\"settings.min_month\"><option value=\"01\">Январь</option><option value=\"02\">Февраль</option><option value=\"03\">Март</option><option value=\"04\">Апрель</option><option value=\"05\">Май</option><option value=\"06\">Июнь</option><option value=\"07\">Июль</option><option value=\"08\">Август</option><option value=\"09\">Сентябрь</option><option value=\"10\">Октябрь</option><option value=\"11\">Ноябрь</option><option value=\"12\">Декабрь</option></select><input class=\"form-control ml-1\" type=\"number\" v-model=\"settings.min_year\"></div><div class=\"input-group mt-1\"><select class=\"form-control custom-select\" v-model=\"settings.month\"><option value=\"01\">Январь</option><option value=\"02\">Февраль</option><option value=\"03\">Март</option><option value=\"04\">Апрель</option><option value=\"05\">Май</option><option value=\"06\">Июнь</option><option value=\"07\">Июль</option><option value=\"08\">Август</option><option value=\"09\">Сентябрь</option><option value=\"10\">Октябрь</option><option value=\"11\">Ноябрь</option><option value=\"12\">Декабрь</option></select><input class=\"form-control ml-1\" type=\"number\" v-model=\"settings.year\"></div></div><div class=\"form-group form-row\"><label><a href=\"https://www.banki.ru/dialog/articles/1153/\" target=\"_blank\">Уровень листинга</a></label><select class=\"form-control custom-select\" v-model=\"settings.maxListLevel\"><option value=\"1\">Только I</option><option value=\"2\">I и II</option><option value=\"3\">Любой</option></select></div><div class=\"form-group form-row\"><label>Минимальный <a href=\"https://www.banki.ru/news/daytheme/?id=11001184\" target=\"_blank\">рейтинг</a></label><div class=\"input-group\"><select class=\"form-control custom-select\" style=\"flex-grow: 4\" v-model=\"settings.minRating\"><option value=\"6\">AAA</option><option value=\"5\">AA</option><option value=\"4\">A</option><option value=\"3\">BBB</option><option value=\"2\">BB</option><option value=\"0\">Любой</option></select><select class=\"form-control custom-select\" style=\"flex-grow: 1\" v-model=\"settings.minRatingMod\" v-show=\"minRatingModVisible\"><option value=\"0.1\">+</option><option value=\"0\"></option><option value=\"-0.1\">-</option></select></div></div><div class=\"form-group form-row\"><label>Периодичность выплат</label><select class=\"form-control custom-select\" v-model=\"settings.maxPerYear\"><option value=\"2\">Не чаще 2 раз в год</option><option value=\"4\">Не чаще 4 раз в год</option><option value=\"-12\">Ежемесячно</option><option value=\"-1\">Любая</option></select></div><div class=\"form-group form-row\"><label>Амортизация</label><select class=\"form-control custom-select\" v-model=\"settings.maxAmort\"><option value=\"-1\">Нет</option><option value=\"360\">Не чаще раза в год</option><option value=\"180\">Не чаще 2 раз в год</option><option value=\"90\">Не чаще 4 раз в год</option><option value=\"-370\">Только в последний год</option><option value=\"0\">Любая</option></select></div><div class=\"form-group form-row\" v-show=\"settings.maxPerYear != -12\"><label>Выплата в</label><select class=\"form-control custom-select\" v-model=\"settings.requiredCouponMonth\"><option value=\"0\">Любом месяце</option><option value=\"1\">Январе</option><option value=\"2\">Феврале</option><option value=\"3\">Марте</option><option value=\"4\">Апреле</option><option value=\"5\">Мае</option><option value=\"6\">Июне</option><option value=\"7\">Июле</option><option value=\"8\">Августе</option><option value=\"9\">Сентябре</option><option value=\"10\">Октябре</option><option value=\"11\">Ноябре</option><option value=\"12\">Декабре</option></select></div><div class=\"form-group form-row\"><label>Купон</label><select class=\"form-control custom-select\" v-model=\"settings.couponType\"><option value=\"0\">Только постоянный</option><option value=\"1\">Без неизвестных</option><option value=\"2\">Любой</option></select></div><div class=\"form-group form-row\"><label><a href=\"https://ru.wikipedia.org/wiki/Текущая_доходность\" target=\"_blank\">Купон к цене</a> не ниже</label><input class=\"form-control\" v-model=\"minCurrentYieldThunk\" type=\"number\" placeholder=\"в процентах\" lang=\"en-US\" min=\"0\" max=\"100\" step=\"0.1\"></div><div class=\"form-group form-row\"><label>Активность торгов</label><select class=\"form-control custom-select\" v-model=\"settings.minTotalTradesPerc\"><option value=\"90\">Высокая</option><option value=\"75\">Выше среднего</option><option value=\"50\">Средняя</option><option value=\"0\">Любая</option></select></div><div class=\"form-group form-row\"><label>Внешний вид</label><select class=\"form-control custom-select\" v-model=\"nightMode\"><option value=\"-1\">Авто</option><option value=\"0\">День</option><option value=\"1\">Ночь</option></select></div></div></div></div></div><div class=\"col-lg-8\"><div class=\"card\"><div class=\"card-body bond-finder-main-card\"><table class=\"table table-sm table-borderless table-hover\" v-show=\"totalFits\"><thead><tr class=\"small text-alpha-60\"><th>Бумага</th><th class=\"d-none d-md-table-cell text-center\">Лист</th><th><span class=\"d-none d-xl-inline\">Рейтинг</span><span class=\"d-inline d-xl-none\">Рейт.</span></th><th class=\"d-none d-sm-table-cell\">Погашение</th><th class=\"d-none d-md-table-cell text-right\">Цена</th><th class=\"text-right\">Купон</th><th class=\"text-right\"><span class=\"d-none d-xl-inline\">Доходность</span><span class=\"d-inline d-xl-none\">Доходн.</span></th></tr></thead><tbody><tr is=\"bond-row\" v-for=\"r in reportRows\" v-show=\"r.fits &amp;&amp; (showAll || r.top)\" v-bind:key=\"r.isin\" v-bind:row=\"r\"></tr></tbody></table><button class=\"btn btn-block btn-secondary\" v-show=\"!reportError &amp;&amp; !showAll\" v-on:click=\"showAll = true\">Показать все ({{ totalFits }})</button><button class=\"btn btn-block btn-secondary mb-4\" v-show=\"totalFits\" v-on:click=\"clipboardButtonClick\">Копировать таблицу <span class=\"position-absolute ml-1\" v-show=\"showClipboardCheck\">&check;</span></button><span class=\"text-danger\" v-show=\"!totalFits &amp;&amp; !reportError\">Ничего не найдено. Покрутите настройки.</span><div v-if=\"reportError\"><h5>Здесь будет список облигаций</h5><p>Пожалуйста, подключитесь к Интернету и нажмите кнопку:</p><p><button class=\"btn btn-lg btn-outline-primary\" onclick=\"location.reload()\">Загрузить данные</button></p></div><div v-show=\"hasABI\"><span class=\"bond-finder-legend-star text-success\">*</span>\nВходит в <a href=\"https://www.moex.com/ru/index/RUABICP\" target=\"_blank\">композитный индекс</a></div><div v-show=\"hasCBHY\"><span class=\"bond-finder-legend-star\"><sup class=\"text-success\">вд</sup></span>\nВходит в <a href=\"https://www.moex.com/ru/index/RUCBHYCP\" target=\"_blank\">индекс ВДО ПИР</a></div><div v-show=\"hasQualOnly\"><span class=\"bond-finder-legend-star\"><sup class=\"text-danger\">кв</sup></span>\nБумаги для <a href=\"https://www.banki.ru/news/daytheme/?id=10970880\" target=\"_blank\">квалов</a></div><div v-show=\"hasFutureAmort\"><div class=\"d-none d-sm-block\"><span class=\"bond-finder-legend-star\"><sup class=\"text-alpha-60\">A</sup></span>\nБудет амортизация</div></div><div v-show=\"hasDownstairs\"><span class=\"bond-finder-legend-star\"><sup class=\"text-danger\">↓</sup></span> Купон-<a href=\"https://bcs-express.ru/novosti-i-analitika/lestnichnyi-kupon-stoit-li-pokupat-takie-obligatsii\" target=\"_blank\">лесенка</a></div><div v-show=\"hasNonFixed\"><span class=\"bond-finder-legend-star text-danger\">**</span> Есть неизвестные купоны</div><div v-show=\"hasOffer\"><span class=\"bond-finder-legend-star\"><sup class=\"text-danger\">оф</sup></span> Предусмотрена <a href=\"https://bcs-express.ru/novosti-i-analitika/davaite-pomnit-ob-oferte\" target=\"_blank\">оферта</a></div><div v-show=\"hasHighRisk\"><div class=\"d-none d-md-block\"><span class=\"bond-finder-legend-star\"></span>\nПИР &ndash; <a href=\"https://www.moex.com/ru/markets/risksector/\" target=\"_blank\">сектор повышенного риска</a></div></div><div class=\"mt-3\" v-show=\"totalFits\"><div><span class=\"bond-finder-legend-star\"></span>\nКак считается <a href=\"https://ru.wikipedia.org/wiki/Доходность_к_погашению\" target=\"_blank\">доходность</a>?</div><div v-show=\"!settings.rub\"><span class=\"bond-finder-legend-star\"></span>\nЧто такое <a href=\"https://www.banki.ru/news/daytheme/?id=10975268\" target=\"_blank\">замещающие облигации</a>?</div></div></div></div><div class=\"card mt-2 bg-secondary text-white\" v-if=\"!reportError\"><div class=\"card-body\">Вы рискуете своим капиталом.\nДоходность инвестиций не гарантируется.\nИнформация предназначена для личного использования.</div></div><div class=\"m-2 text-muted text-right\" v-if=\"reportDate\">Актуальность: {{ reportDate }}</div></div></div></div>","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = function(module) {\n\tvar getter = module && module.__esModule ?\n\t\tfunction() { return module['default']; } :\n\t\tfunction() { return module; };\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = function(exports, definition) {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = function(obj, prop) { return Object.prototype.hasOwnProperty.call(obj, prop); }","var __WEBPACK_NAMESPACE_OBJECT__ = Vue;","import { CouponFlags } from \"./coupon-values\";\r\nimport IReportRow from \"./report-row\";\r\n\r\nexport function ratingText(row: IReportRow): string {\r\n    switch (row.rating) {\r\n        case 6: return \"AAA\";\r\n\r\n        case 5.1: return \"AA+\";\r\n        case 5.0: return \"AA\";\r\n        case 4.9: return \"AA-\";\r\n\r\n        case 4.1: return \"A+\";\r\n        case 4.0: return \"A\";\r\n        case 3.9: return \"A-\";\r\n\r\n        case 3.1: return \"BBB+\";\r\n        case 3.0: return \"BBB\";\r\n        case 2.9: return \"BBB-\";\r\n\r\n        case 2.1: return \"BB+\";\r\n        case 2.0: return \"BB\";\r\n        case 1.9: return \"BB-\";\r\n\r\n        case 1.1: return \"B+\";\r\n        case 1.0: return \"B\";\r\n        case 0.9: return \"B-\";\r\n    }\r\n    return \"–\";\r\n}\r\n\r\nexport function couponHintText(row: IReportRow) {\r\n    const { couponFlags } = row;\r\n    if (couponFlags & CouponFlags.Downstairs) {\r\n        return \" ↓\";\r\n    }\r\n    if (couponFlags & CouponFlags.NonFixed) {\r\n        return \"**\";\r\n    }\r\n    return \"\";\r\n}\r\n\r\nconst TSV_LEN_TEXT = 12;\r\nconst TSV_LEN_TAGS = 7;\r\nconst TSV_LEN_LIST_LEVEL = 4;\r\nconst TSV_LEN_RATING = 6;\r\nconst TSV_LEN_DATE = 10;\r\nconst TSV_LEN_NUM = 8;\r\n\r\nexport function toTsvHeader() {\r\n    const cells = [\r\n        pad(\"isin\", TSV_LEN_TEXT),\r\n        pad(\"name\", TSV_LEN_TEXT),\r\n        pad(\"\", TSV_LEN_TAGS),\r\n        pad(\"list\", TSV_LEN_LIST_LEVEL, true),\r\n        pad(\"rating\", TSV_LEN_RATING),\r\n        pad(\"mat_date\", TSV_LEN_DATE),\r\n        \"\",\r\n        pad(\"wa_price\", TSV_LEN_NUM, true),\r\n        \"\",\r\n        pad(\"coupon\", TSV_LEN_NUM, true),\r\n        \"\",\r\n        pad(\"yield\", TSV_LEN_NUM, true)\r\n    ];\r\n    return cells.join(\"\\t\");\r\n}\r\n\r\nexport function toTsvLine(row: IReportRow) {\r\n    const cells = [\r\n        row.isin,\r\n        pad(row.name, TSV_LEN_TEXT),\r\n        tags(),\r\n        pad(String(row.listLevel), TSV_LEN_LIST_LEVEL, true),\r\n        pad(ratingText(row), TSV_LEN_RATING),\r\n        row.maturityDate,\r\n        row.hasFutureAmort ? \"A\" : \"\",\r\n        numeric(row.waprice),\r\n        couponHintText(row),\r\n        numeric(row.couponValues.next),\r\n        row.hasOffer ? \"оф\" : \"\",\r\n        numeric(row.closeYield)\r\n    ];\r\n\r\n    function tags(): string {\r\n        const list: string[] = [ ];\r\n\r\n        if (row.isQualOnly) {\r\n            list.push(\"кв\");\r\n        } else if (row.inABI) {\r\n            list.push(\"*\");\r\n        } else if (row.inCBHY) {\r\n            list.push(\"вд\");\r\n        }\r\n\r\n        if (row.isHighRisk) {\r\n            list.push(\"пир\");\r\n        }\r\n\r\n        return pad(list.join(\", \"), TSV_LEN_TAGS);\r\n    }\r\n\r\n    function numeric(value: number | null): string {\r\n        const text = value == null ? \"\" : String(value);\r\n        return pad(text, TSV_LEN_NUM, true);\r\n    }\r\n\r\n    return cells.join(\"\\t\");\r\n}\r\n\r\nfunction pad(text: string, len: number, left = false): string {\r\n    while (text.length < len) {\r\n        if (left) {\r\n            text = \" \" + text;\r\n        } else {\r\n            text = text + \" \";\r\n        }\r\n    }\r\n    return text;\r\n}\r\n","import Vue from \"vue\";\r\nimport { CouponFlags } from \"./coupon-values\";\r\nimport IReportRow from \"./report-row\";\r\nimport { couponHintText, ratingText } from \"./report-row-extensions\";\r\n\r\nimport assignRenderFuncs from \"./bond-row-template.pug\";\r\n\r\nconst PILL_BADGE_CLASS_PREFIX = \"badge badge-pill badge-\";\r\n\r\ninterface IContext {\r\n    row: IReportRow;\r\n}\r\n\r\nVue.component(\"bond-row\", assignRenderFuncs({\r\n    props: [ \"row\" ],\r\n    computed: {\r\n\r\n        moexUrl(this: IContext) {\r\n            return \"https://www.moex.com/ru/issue.aspx?code=\" + this.row.isin;\r\n        },\r\n\r\n        ratingText(this: IContext) {\r\n            return ratingText(this.row);\r\n        },\r\n\r\n        couponHintText(this: IContext) {\r\n            return couponHintText(this.row);\r\n        },\r\n\r\n        couponValueText(this: IContext) {\r\n            const row = this.row;\r\n            if (row.couponFlags & CouponFlags.InterestFree) {\r\n                return \"–\";\r\n            }\r\n            return row.couponValues.next;\r\n        },\r\n\r\n        listLevelBadgeClass(this: IContext) {\r\n            const row = this.row;\r\n            switch (row.listLevel) {\r\n                case 1: return PILL_BADGE_CLASS_PREFIX + \"success\";\r\n                case 2: return PILL_BADGE_CLASS_PREFIX + \"warning\";\r\n                case 3: return row.isHighRisk\r\n                    ? PILL_BADGE_CLASS_PREFIX + \"dark bond-finder-ir-badge\"\r\n                    : PILL_BADGE_CLASS_PREFIX + \"danger\";\r\n            }\r\n        },\r\n\r\n        listLevelName(this: IContext) {\r\n            const row = this.row;\r\n            switch (row.listLevel) {\r\n                case 1: return \"I\";\r\n                case 2: return \"II\";\r\n                case 3: return row.isHighRisk\r\n                    ? \"\\xa0\"\r\n                    : \"III\";\r\n            }\r\n        },\r\n\r\n        showCouponStar(this: IContext) {\r\n            return Boolean(this.row.couponFlags & CouponFlags.NonFixed);\r\n        },\r\n\r\n        showCouponHint(this: IContext) {\r\n            return Boolean(this.row.couponFlags & CouponFlags.Downstairs);\r\n        },\r\n\r\n        rowClass(this: IContext) {\r\n            return this.row.infoUrl ? \"bond-finder-separator\" : null;\r\n        }\r\n    }\r\n}));\r\n","export interface ICouponValues {\r\n    readonly next: number | null;\r\n    readonly remainingAvg: number | null;\r\n}\r\n\r\nexport const enum CouponFlags {\r\n    Const = 1,\r\n    Downstairs = 2,\r\n    InterestFree = 4,\r\n    NonFixed = 8,\r\n}\r\n\r\nexport function toCouponValues(list: ReadonlyArray<number | null>): ICouponValues {\r\n    const len = list.length;\r\n    const next = len > 0 ? list[0] : 0;\r\n    const remainingAvg = len > 1 ? list[1] : next;\r\n    return { next, remainingAvg };\r\n}\r\n\r\nexport function calcCouponFlags({ next, remainingAvg }: ICouponValues): CouponFlags {\r\n    let flags = 0;\r\n\r\n    const fixed = next != null && remainingAvg != null;\r\n    if (!fixed) {\r\n        flags |= CouponFlags.NonFixed;\r\n    }\r\n\r\n    const interestFree = next === 0 && remainingAvg === 0;\r\n    if (interestFree) {\r\n        flags |= CouponFlags.InterestFree;\r\n    }\r\n\r\n    if (fixed && !interestFree && next === remainingAvg) {\r\n        flags |= CouponFlags.Const;\r\n    }\r\n\r\n    if (fixed && remainingAvg < next) {\r\n        flags |= CouponFlags.Downstairs;\r\n    }\r\n\r\n    return flags;\r\n}\r\n","function getStorageKey(key: string) {\r\n    return \"bond-finder-\" + key;\r\n}\r\n\r\nexport function load(key: string, json = false) {\r\n    try {\r\n        const value = localStorage.getItem(getStorageKey(key));\r\n        return json && value != null ? JSON.parse(value) : value;\r\n    } catch {\r\n        return null;\r\n    }\r\n}\r\n\r\nexport function save(key: string, value: any, json = false) {\r\n    try {\r\n        localStorage.setItem(\r\n            getStorageKey(key),\r\n            (json ? JSON.stringify : String)(value)\r\n        );\r\n    } catch {\r\n        // mute\r\n    }\r\n}\r\n","import { calcCouponFlags, toCouponValues } from \"./coupon-values\";\r\nimport IReportRow from \"./report-row\";\r\nimport * as storageUtil from \"./storageUtil\";\r\n\r\nconst URL_PREFIX_LIST = [\r\n    \"bond-finder-lab.github.io/backend\",\r\n    \"storage.yandexcloud.net/bond-finder\",\r\n    \"global.s3.cloud.ru/bond-finder\"\r\n] as const;\r\n\r\nconst URL_PREFIX_COUNT = URL_PREFIX_LIST.length;\r\nconst URL_PREFIX_OFFSET = Date.now() % URL_PREFIX_COUNT;\r\n\r\nconst CACHE_KEY_REPORT = \"report-cache-v1\";\r\nconst CACHE_KEY_DATE = \"date\";\r\n\r\nconst LAST_DATE = storageUtil.load(CACHE_KEY_DATE) || \"\";\r\n\r\ninterface IReport {\r\n    readonly date: string;\r\n    readonly rows: ReadonlyArray<IReportRow>;\r\n    readonly error?: boolean;\r\n}\r\n\r\ntype ReportReadyCallback = (report: IReport) => void;\r\n\r\nfunction convert(source: any): IReport {\r\n    const cols = source.cols as readonly string[];\r\n    const rows = source.rows as readonly any[];\r\n\r\n    const indexOf = {} as Record<string, number>;\r\n    for (let i = cols.length - 1; i >= 0; i--) {\r\n        indexOf[cols[i]] = i;\r\n    }\r\n\r\n    const hasRubCol = \"rub\" in indexOf;\r\n\r\n    return {\r\n        date: source.date as string,\r\n        rows: rows.map((r) => {\r\n            const isin = r[indexOf.isin] as string;\r\n            const name = r[indexOf.name] as string;\r\n            const sector = r[indexOf.sector] as number;\r\n            const listLevel = r[indexOf.list_level] as number;\r\n            const totalTradesPerc = r[indexOf.total_trades_perc] as number;\r\n            const maturityDate = r[indexOf.maturity_date] as string;\r\n            const minDaysBetweenAmort = r[indexOf.min_days_between_amort] as number;\r\n            const couponMonths = r[indexOf.coupon_months] as readonly number[];\r\n            const couponValues = toCouponValues(r[indexOf.coupon_values]);\r\n            const closeYield = r[indexOf.close_yield] as number | null;\r\n            const hasOffer = Boolean(r[indexOf.has_offer]);\r\n            const inABI = Boolean(r[indexOf.in_abi]);\r\n            const inCBHY = Boolean(r[indexOf.in_cbhy]);\r\n            const isHighRisk = Boolean(r[indexOf.high_risk]);\r\n            const isQualOnly = Boolean(r[indexOf.qual]);\r\n            const rub = !hasRubCol || Boolean(r[indexOf.rub]);\r\n            const rating = r[indexOf.rating] as number;\r\n            const waprice = r[indexOf.waprice] as number;\r\n            const amortRangeDays = r[indexOf.amort_range_days] as number;\r\n            const pending = Boolean(r[indexOf.pending]);\r\n\r\n            const isOFZPK = isOFZ(\"ПК\");\r\n            const isOFZIN = isOFZ(\"ИН\");\r\n\r\n            function isOFZ(type: string) {\r\n                return sector === 1\r\n                    && name.substring(0, 4) === \"ОФЗ-\"\r\n                    && name.substring(4, 6) === type;\r\n            }\r\n\r\n            function calcCurrentYield() {\r\n                const coupon = couponValues.remainingAvg || couponValues.next;\r\n\r\n                if (coupon && waprice) {\r\n                    return 100 * coupon / waprice;\r\n                }\r\n\r\n                return 0;\r\n            }\r\n\r\n            return {\r\n                isin,\r\n                name,\r\n                sector,\r\n                listLevel,\r\n                totalTradesPerc,\r\n                maturityDate,\r\n                minDaysBetweenAmort,\r\n                couponMonths,\r\n                couponValues,\r\n                closeYield,\r\n                hasOffer,\r\n                inABI,\r\n                inCBHY,\r\n                isHighRisk,\r\n                isQualOnly,\r\n                rub,\r\n                rating,\r\n                waprice,\r\n                amortRangeDays,\r\n                pending,\r\n\r\n                isOFZPK,\r\n                isOFZIN,\r\n                currentYield: calcCurrentYield(),\r\n                couponFlags: calcCouponFlags(couponValues),\r\n                hasFutureAmort: minDaysBetweenAmort > 0, // amortRangeDays is auxiliary\r\n\r\n                fits: false,\r\n                top: false,\r\n                infoUrl: \"\"\r\n            };\r\n        })\r\n    };\r\n}\r\n\r\nfunction convertFromTextSafe(text: string): IReport {\r\n    try {\r\n        return convert(JSON.parse(text));\r\n    } catch {\r\n        return {\r\n            error: true,\r\n            date: \"\",\r\n            rows: [ ]\r\n        };\r\n    }\r\n}\r\n\r\nfunction loadCore(urlIndex: number, callback: ReportReadyCallback) {\r\n    const url = \"https://\"\r\n        + URL_PREFIX_LIST[(URL_PREFIX_OFFSET + urlIndex) % URL_PREFIX_COUNT]\r\n        + \"/report-v1.json?_=\" + Date.now();\r\n\r\n    const isLastUrl = urlIndex === URL_PREFIX_COUNT - 1;\r\n\r\n    const xhr = new XMLHttpRequest();\r\n    xhr.open(\"GET\", url, true);\r\n    xhr.timeout = (isLastUrl ? 10 : 3) * 1000;\r\n\r\n    function handleResponseText(responseText: string) {\r\n        let report = convertFromTextSafe(responseText);\r\n        if (report.error || report.date < LAST_DATE) {\r\n            if (!isLastUrl) {\r\n                loadCore(1 + urlIndex, callback);\r\n                return;\r\n            }\r\n            report = convertFromTextSafe(storageUtil.load(CACHE_KEY_REPORT));\r\n        } else {\r\n            storageUtil.save(CACHE_KEY_REPORT, responseText);\r\n            storageUtil.save(CACHE_KEY_DATE, report.date);\r\n        }\r\n        callback(report);\r\n    }\r\n\r\n    xhr.onreadystatechange = function() {\r\n        if (this.readyState === 4) {\r\n            const { status, responseText } = this;\r\n            handleResponseText(status === 200 ? responseText : \"\");\r\n        }\r\n    };\r\n\r\n    xhr.send();\r\n}\r\n\r\nexport default (callback: ReportReadyCallback) => loadCore(0, callback);\r\n","import * as storageUtil from \"./storageUtil\";\r\n\r\nconst KEY = \"night\";\r\n\r\nlet currentMode: number;\r\nlet wasScrolled = false;\r\n\r\nfunction prefersDark() {\r\n    try {\r\n        return window.matchMedia && window.matchMedia(\"(prefers-color-scheme: dark)\").matches;\r\n    } catch {\r\n        return false;\r\n    }\r\n}\r\n\r\nfunction loadMode() {\r\n    const loadResult = storageUtil.load(KEY);\r\n    if (loadResult == null) {\r\n        return -1;\r\n    }\r\n    return Number(loadResult);\r\n}\r\n\r\nexport function getMode() {\r\n    return currentMode;\r\n}\r\n\r\nexport function setMode(mode: number) {\r\n    currentMode = mode;\r\n    storageUtil.save(KEY, mode);\r\n    updateMarkup();\r\n}\r\n\r\nfunction isNight() {\r\n    if (currentMode < 0) {\r\n        return prefersDark();\r\n    }\r\n    return currentMode > 0;\r\n}\r\n\r\nfunction toggleClass(element: HTMLElement, className: string, active: boolean) {\r\n    const classList = element.classList;\r\n    if (active) {\r\n        classList.add(className);\r\n    } else {\r\n        classList.remove(className);\r\n    }\r\n}\r\n\r\nexport function updateMarkup() {\r\n    toggleClass(document.documentElement, \"night\", isNight());\r\n}\r\n\r\nfunction onDocScroll() {\r\n    const scrolled = window.pageYOffset > 0;\r\n    if (wasScrolled !== scrolled) {\r\n        toggleClass(document.documentElement, \"scrolled\", scrolled);\r\n        wasScrolled = scrolled;\r\n    }\r\n}\r\n\r\ncurrentMode = loadMode();\r\n\r\ndocument.addEventListener(\"scroll\", onDocScroll, false);\r\n","import * as storageUtil from \"./storageUtil\";\r\n\r\nconst STORAGE_KEY = \"settings-v1\";\r\n\r\nexport interface ISettings {\r\n    rub: boolean;\r\n    min_month: string;\r\n    min_year: string;\r\n    month: string;\r\n    year: string;\r\n    sector1: boolean;\r\n    sector2: boolean;\r\n    sector3: boolean;\r\n    govOnly: boolean;\r\n    highRisk: boolean;\r\n    qual: boolean;\r\n    offer: boolean;\r\n    maxListLevel: string;\r\n    minRating: string;\r\n    minRatingMod: string;\r\n    maxPerYear: string;\r\n    requiredCouponMonth: string;\r\n    couponType: string;\r\n    minCurrentYield: string;\r\n    minCurrentYieldOther: string;\r\n    maxAmort: string;\r\n    minTotalTradesPerc: string;\r\n}\r\n\r\nconst TODAY = new Date();\r\nconst TODAY_PLUS_1Y = new Date(TODAY.getFullYear() + 1, TODAY.getMonth(), 1);\r\nconst TODAY_PLUS_5Y = new Date(TODAY.getFullYear() + 5, TODAY.getMonth(), 1);\r\n\r\nfunction getMonthText(date: Date): string {\r\n    const m = 1 + date.getMonth();\r\n    return m > 9 ? String(m) : (\"0\" + m);\r\n}\r\n\r\nconst DEFAULT_SETTINGS: ISettings = {\r\n    rub: true,\r\n    min_month: getMonthText(TODAY_PLUS_1Y),\r\n    month: getMonthText(TODAY_PLUS_5Y),\r\n    min_year: String(TODAY_PLUS_1Y.getFullYear()),\r\n    year: String(TODAY_PLUS_5Y.getFullYear()),\r\n    sector1: true,\r\n    sector2: true,\r\n    sector3: true,\r\n    govOnly: false,\r\n    highRisk: false,\r\n    qual: false,\r\n    offer: false,\r\n    maxListLevel: \"2\",\r\n    minRating: \"4\",\r\n    minRatingMod: \"-0.1\",\r\n    maxPerYear: \"-1\",\r\n    requiredCouponMonth: \"0\",\r\n    couponType: \"0\",\r\n    minCurrentYield: \"\",\r\n    minCurrentYieldOther: \"\",\r\n    maxAmort: \"90\",\r\n    minTotalTradesPerc: \"50\"\r\n};\r\n\r\nexport function load(): ISettings {\r\n    const result = { } as ISettings;\r\n    const storedSettings = storageUtil.load(STORAGE_KEY, true) as Readonly<ISettings> | null;\r\n    const storedSettingsOk = storedSettings != null && typeof storedSettings === \"object\";\r\n\r\n    for (const key of Object.keys(DEFAULT_SETTINGS)) {\r\n        const source = (storedSettingsOk && key in storedSettings) ? storedSettings : DEFAULT_SETTINGS;\r\n        result[key] = source[key];\r\n    }\r\n\r\n    if (result.couponType === \"3\") {\r\n        result.couponType = \"2\";\r\n        result.offer = true;\r\n    }\r\n\r\n    return result;\r\n}\r\n\r\nexport function save(settings: ISettings) {\r\n    storageUtil.save(STORAGE_KEY, settings, true);\r\n}\r\n\r\nexport function minRatingModApplicable(minRating: number) {\r\n    return minRating > 0 && minRating < 6;\r\n}\r\n\r\nexport function getMinCurrentYield(settings: ISettings): string {\r\n    return settings.rub\r\n        ? settings.minCurrentYield\r\n        : settings.minCurrentYieldOther;\r\n}\r\n\r\nexport function setMinCurrentYield(settings: ISettings, value: string): void {\r\n    if (settings.rub) {\r\n        settings.minCurrentYield = value;\r\n    } else {\r\n        settings.minCurrentYieldOther = value;\r\n    }\r\n}\r\n","import { CouponFlags } from \"./coupon-values\";\r\nimport IReportRow from \"./report-row\";\r\nimport { ISettings, minRatingModApplicable, save as saveSettings } from \"./settings\";\r\nimport { getMinCurrentYield } from \"./settings\";\r\n\r\nexport interface IViewModel {\r\n    nightMode: number;\r\n    settings: ISettings;\r\n    reportDate?: string;\r\n    reportRows: ReadonlyArray<IReportRow>;\r\n    reportError?: boolean;\r\n    totalFits?: number;\r\n    showAll?: boolean;\r\n    hasABI?: boolean;\r\n    hasCBHY?: boolean;\r\n    hasHighRisk?: boolean;\r\n    hasQualOnly?: boolean;\r\n    hasDownstairs?: boolean;\r\n    hasNonFixed?: boolean;\r\n    hasOffer?: boolean;\r\n    collapseForm?: boolean;\r\n    hasFutureAmort?: boolean;\r\n    showClipboardCheck?: boolean;\r\n    // showAlert?: boolean;\r\n}\r\n\r\nexport function applySettings(VM: IViewModel) {\r\n    saveSettings(VM.settings);\r\n\r\n    const settings = VM.settings;\r\n    const rub = settings.rub;\r\n    const maturityDateMin = [ clampYear(settings.min_year), settings.min_month, \"01\" ].join(\"-\");\r\n    const maturityDateMax = [ clampYear(settings.year), settings.month, \"31\" ].join(\"-\");\r\n    const maxListLevel = Number(settings.maxListLevel);\r\n    const minRating = Number(settings.minRating);\r\n    const minRatingMod = Number(settings.minRatingMod);\r\n    const maxPerYear = Number(settings.maxPerYear);\r\n    const requiredCouponMonth = Number(settings.requiredCouponMonth);\r\n    const amortDaysParam = Number(settings.maxAmort);\r\n    const minTotalTradesPerc = Number(settings.minTotalTradesPerc);\r\n    const minCurrentYield = Number(getMinCurrentYield(settings));\r\n\r\n    const maxAllowedCouponType = Number(settings.couponType);\r\n    const requireFixedCoupon = maxAllowedCouponType < 2;\r\n    const requireConstCoupon = maxAllowedCouponType < 1;\r\n\r\n    const minRatingCombo = minRatingModApplicable(minRating) ? (minRating + minRatingMod) : minRating;\r\n\r\n    const TOP = 20;\r\n    const MAX = 1000;\r\n\r\n    let totalFits = 0;\r\n    let hasABI = false;\r\n    let hasCBHY = false;\r\n    let hasHighRisk = false;\r\n    let hasQualOnly = false;\r\n    let hasDownstairs = false;\r\n    let hasNonFixed = false;\r\n    let hasOffer = false;\r\n    let hasFutureAmort = false;\r\n\r\n    let ofzPKUrlAssigned = false;\r\n    let ofzINUrlAssigned = false;\r\n\r\n    for (const row of VM.reportRows) {\r\n        if (totalFits < MAX && fits(row)) {\r\n            const { couponFlags } = row;\r\n            totalFits++;\r\n            row.fits = true;\r\n            row.top = totalFits <= TOP;\r\n            hasFutureAmort = hasFutureAmort || row.hasFutureAmort;\r\n            hasABI = hasABI || row.inABI;\r\n            hasCBHY = hasCBHY || row.inCBHY;\r\n            hasHighRisk = hasHighRisk || row.isHighRisk;\r\n            hasQualOnly = hasQualOnly || row.isQualOnly;\r\n            hasDownstairs = hasDownstairs || Boolean(couponFlags & CouponFlags.Downstairs);\r\n            hasNonFixed = hasNonFixed || Boolean(couponFlags & CouponFlags.NonFixed);\r\n            hasOffer = hasOffer || row.hasOffer;\r\n\r\n            row.infoUrl = \"\";\r\n            if (!row.closeYield) {\r\n                if (!ofzPKUrlAssigned && row.isOFZPK) {\r\n                    ofzPKUrlAssigned = true;\r\n                    row.infoUrl = \"https://bcs-express.ru/novosti-i-analitika/ofz-pk-s-priviazkoi-k-ruonia-kak-zashchitit-sredstva-ot-infliatsii\";\r\n                } else if (!ofzINUrlAssigned && row.isOFZIN) {\r\n                    ofzINUrlAssigned = true;\r\n                    row.infoUrl = \"https://bcs-express.ru/novosti-i-analitika/ofz-in-ili-kak-garantirovano-zashchitit-sebia-ot-infliatsii\";\r\n                }\r\n            }\r\n        } else {\r\n            row.fits = row.top = false;\r\n        }\r\n    }\r\n\r\n    VM.totalFits = totalFits;\r\n    VM.showAll = totalFits / TOP < 1.5;\r\n    VM.hasABI = hasABI;\r\n    VM.hasCBHY = hasCBHY;\r\n    VM.hasHighRisk = hasHighRisk;\r\n    VM.hasQualOnly = hasQualOnly;\r\n    VM.hasDownstairs = hasDownstairs;\r\n    VM.hasNonFixed = hasNonFixed;\r\n    VM.hasOffer = hasOffer;\r\n    VM.hasFutureAmort = hasFutureAmort;\r\n    VM.showClipboardCheck = false;\r\n\r\n    function fits(row: IReportRow) {\r\n        if (row.pending) {\r\n            return false;\r\n        }\r\n\r\n        if (row.rub !== rub) {\r\n            return false;\r\n        }\r\n\r\n        if (row.isHighRisk && !settings.highRisk) {\r\n            return false;\r\n        }\r\n\r\n        if (row.isQualOnly && !settings.qual) {\r\n            return false;\r\n        }\r\n\r\n        if (row.hasOffer && !settings.offer) {\r\n            return false;\r\n        }\r\n\r\n        if (row.listLevel > maxListLevel) {\r\n            return false;\r\n        }\r\n\r\n        if (row.rating < minRatingCombo) {\r\n            return false;\r\n        }\r\n\r\n        const rowCouponFlags = row.couponFlags;\r\n\r\n        if (requireFixedCoupon && (rowCouponFlags & CouponFlags.NonFixed)) {\r\n            return false;\r\n        }\r\n\r\n        if (requireConstCoupon && !(rowCouponFlags & CouponFlags.Const)) {\r\n            return false;\r\n        }\r\n\r\n        if (minCurrentYield > 0 && row.currentYield < minCurrentYield) {\r\n            return false;\r\n        }\r\n\r\n        if (row.totalTradesPerc < minTotalTradesPerc) {\r\n            return false;\r\n        }\r\n\r\n        if (row.maturityDate < maturityDateMin || row.maturityDate > maturityDateMax) {\r\n            return false;\r\n        }\r\n\r\n        if (rub) {\r\n            if (settings.sector1 || settings.sector2 || settings.sector3) {\r\n                if (row.sector === 1 && !settings.sector1) { return false; }\r\n                if (row.sector === 2 && !settings.sector2) { return false; }\r\n                if (row.sector === 3 && !settings.sector3) { return false; }\r\n            }\r\n        } else {\r\n            if (settings.govOnly && row.sector !== 1) { return false; }\r\n        }\r\n\r\n        const rowCouponIsMonthly = row.couponMonths[0] === -12;\r\n\r\n        if (maxPerYear > -1) {\r\n            if (rowCouponIsMonthly) {\r\n                return false;\r\n            }\r\n            if (row.couponMonths.length > maxPerYear) {\r\n                return false;\r\n            }\r\n        }\r\n\r\n        if (maxPerYear === -12 && !rowCouponIsMonthly) {\r\n            return false;\r\n        }\r\n\r\n        if (requiredCouponMonth > 0 && !rowCouponIsMonthly) {\r\n            if (row.couponMonths.indexOf(requiredCouponMonth) < 0) {\r\n                return false;\r\n            }\r\n        }\r\n\r\n        if (row.hasFutureAmort) {\r\n            if (amortDaysParam === -1) {\r\n                return false;\r\n            }\r\n            if (amortDaysParam > 0) {\r\n                if (row.minDaysBetweenAmort < amortDaysParam) {\r\n                    return false;\r\n                }\r\n            }\r\n            if (amortDaysParam < -1) {\r\n                if (row.amortRangeDays > -amortDaysParam) {\r\n                    return false;\r\n                }\r\n            }\r\n        }\r\n\r\n        return true;\r\n    }\r\n}\r\n\r\nfunction clampYear(year: string): string {\r\n    if (year.length < 4) {\r\n        return \"2000\";\r\n    }\r\n    if (year.length > 4) {\r\n        return \"3000\";\r\n    }\r\n    return year;\r\n}\r\n","import Vue from \"vue\";\r\nimport \"./bond-row-component\";\r\nimport loadReport from \"./load-report\";\r\nimport * as nightMode from \"./night-mode\";\r\nimport { toTsvHeader, toTsvLine } from \"./report-row-extensions\";\r\nimport { load as loadSettings, minRatingModApplicable } from \"./settings\";\r\nimport { getMinCurrentYield, setMinCurrentYield } from \"./settings\";\r\nimport * as storageUtil from \"./storageUtil\";\r\nimport { applySettings, IViewModel } from \"./view-model\";\r\n\r\nimport assignRootRenderFuncs from \"./index-root-template.pug\";\r\n\r\nconst LAUNCH_TIME = Date.now();\r\nconst cordova = (window as any).cordova;\r\nconst ALERT_DISMISS_KEY = \"alert-v1\";\r\n\r\nconst VM: IViewModel = {\r\n    nightMode: nightMode.getMode(),\r\n    collapseForm: window.matchMedia && window.matchMedia(\"(max-width: 992px)\").matches,\r\n    settings: loadSettings(),\r\n    reportRows: [ ]\r\n};\r\n\r\nnightMode.updateMarkup();\r\n\r\nif (cordova) {\r\n    document.addEventListener(\"deviceready\", onCordovaReady, false);\r\n    document.addEventListener(\"deviceconfigchange\", onCordovaConfigChange, false);\r\n    document.documentElement.style.userSelect = \"none\";\r\n    trackExternalLinks();\r\n    ensureFocusedInputVisible();\r\n} else {\r\n    disableFocusedInputWheel();\r\n    filterNumberInputKeys();\r\n}\r\n\r\nloadReport((report) => {\r\n    VM.reportDate = report.date;\r\n    VM.reportRows = report.rows;\r\n\r\n    const reportError = report.error;\r\n    VM.reportError = reportError;\r\n    // VM.showAlert = !reportError && !storageUtil.load(ALERT_DISMISS_KEY);\r\n\r\n    applySettings(VM);\r\n\r\n    new Vue(assignRootRenderFuncs({\r\n        el: \"#vue-root\",\r\n        data: VM,\r\n        watch: {\r\n            nightMode: {\r\n                handler: (value) => nightMode.setMode(value)\r\n            },\r\n            settings: {\r\n                deep: true,\r\n                handler: () => applySettings(VM)\r\n            }\r\n        },\r\n        methods: {\r\n            alertClose: () => storageUtil.save(ALERT_DISMISS_KEY, true),\r\n            clipboardButtonClick\r\n        },\r\n        computed: {\r\n            minRatingModVisible(this: IViewModel) {\r\n                return minRatingModApplicable(Number(this.settings.minRating));\r\n            },\r\n            minCurrentYieldThunk: {\r\n                get(this: IViewModel) {\r\n                    return getMinCurrentYield(this.settings);\r\n                },\r\n                set(this: IViewModel, value: string) {\r\n                    setMinCurrentYield(this.settings, value);\r\n                }\r\n            }\r\n        }\r\n    }));\r\n\r\n    document.getElementById(\"bond-finder-loading\")!.style.display = \"none\";\r\n\r\n    if (!cordova) {\r\n        initFontSize();\r\n    }\r\n});\r\n\r\nfunction onCordovaReady() {\r\n    document.addEventListener(\"resume\", onCordovaResume, false);\r\n}\r\n\r\nfunction onCordovaResume() {\r\n    if (Date.now() - LAUNCH_TIME > 1234 * 1000) {\r\n        location.reload();\r\n    }\r\n}\r\n\r\nfunction onCordovaConfigChange() {\r\n    nightMode.updateMarkup();\r\n}\r\n\r\nfunction initFontSize() {\r\n    const html = document.documentElement;\r\n    html.style.fontSize = \"medium\";\r\n    html.style.fontSize = 1600 / parseFloat(getComputedStyle(html).fontSize) + \"%\";\r\n}\r\n\r\nfunction trackExternalLinks() {\r\n    document.addEventListener(\"click\", (e) => {\r\n        const a = e.target as HTMLAnchorElement;\r\n        if (a.tagName === \"A\" && !confirmExternalLink(a.href)) {\r\n            e.preventDefault();\r\n            e.stopPropagation();\r\n        }\r\n    }, false);\r\n}\r\n\r\nfunction ensureFocusedInputVisible() {\r\n    document.addEventListener(\"click\", (e) => {\r\n        const element = e.target as HTMLElement;\r\n        if (isInput(element)) {\r\n            const { bottom } = element.getBoundingClientRect();\r\n            const delta = bottom - innerHeight / 2;\r\n            if (delta > 0) {\r\n                try {\r\n                    scrollBy({ behavior: \"smooth\", top: delta });\r\n                } catch {\r\n                    scrollBy(0, delta);\r\n                }\r\n            }\r\n        }\r\n    }, false);\r\n}\r\n\r\nfunction disableFocusedInputWheel() {\r\n    function handler(e: WheelEvent) {\r\n        const element = e.target as HTMLElement;\r\n        if (document.activeElement === element && isInput(element)) {\r\n            e.preventDefault();\r\n        }\r\n    }\r\n    document.addEventListener(\"wheel\", handler, { passive: false });\r\n}\r\n\r\nfunction filterNumberInputKeys() {\r\n    const ALLOWED_CHARS = {\r\n        \".\": true,\r\n        \"-\": true\r\n    };\r\n\r\n    for (let i = 0; i < 10; i++) {\r\n        ALLOWED_CHARS[i] = true;\r\n    }\r\n\r\n    function handler(e: KeyboardEvent) {\r\n        const element = e.target as HTMLInputElement;\r\n        if (isInput(element) && element.type === \"number\") {\r\n            const key = e.key || String.fromCharCode(e.keyCode);\r\n            if (!ALLOWED_CHARS[key]) {\r\n                e.preventDefault();\r\n            }\r\n        }\r\n    }\r\n\r\n    document.addEventListener(\"keypress\", handler, { passive: false });\r\n}\r\n\r\nfunction isInput(element: HTMLElement) {\r\n    return element.tagName === \"INPUT\";\r\n}\r\n\r\nfunction confirmExternalLink(href: string) {\r\n    if (!href) {\r\n        return true;\r\n    }\r\n\r\n    const kind = href.indexOf(\"moex.com/\") > -1 ? \"moex\" : \"other\";\r\n    const storageKey = \"confirm-external-link-\" + kind;\r\n\r\n    if (!storageUtil.load(storageKey)) {\r\n        const subj = kind === \"moex\"\r\n            ? \"сайт Московской Биржи\"\r\n            : \"внешний сайт\";\r\n        if (!confirm(\"Пожалуйста, подтвердите переход на \" + subj)) {\r\n            return false;\r\n        }\r\n        storageUtil.save(storageKey, \"1\");\r\n    }\r\n\r\n    return true;\r\n}\r\n\r\nfunction clipboardButtonClick() {\r\n    const tsvBuilder = [ toTsvHeader() ];\r\n    for (const r of VM.reportRows) {\r\n        if (r.fits) {\r\n            tsvBuilder.push(toTsvLine(r));\r\n        }\r\n    }\r\n\r\n    const tsv = tsvBuilder.join(\"\\n\");\r\n\r\n    function onSuccess() {\r\n        if (!cordova) {\r\n            VM.showClipboardCheck = true;\r\n        }\r\n    }\r\n\r\n    function onFailure() {\r\n        alert(\"Не получилось\");\r\n    }\r\n\r\n    if (cordova) {\r\n        cordova.exec(onSuccess, onFailure, \"CordovaPluginUtils\", \"clipboardWrite\", [ tsv ]);\r\n    } else {\r\n        try {\r\n            navigator.clipboard.writeText(tsv).then(onSuccess, onFailure);\r\n        } catch {\r\n            onFailure();\r\n        }\r\n    }\r\n}\r\n"],"names":["__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","undefined","exports","module","__webpack_modules__","n","getter","__esModule","d","a","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","Vue","ratingText","row","rating","couponHintText","couponFlags","toTsvLine","numeric","value","pad","String","isin","name","list","isQualOnly","push","inABI","inCBHY","isHighRisk","join","listLevel","maturityDate","hasFutureAmort","waprice","couponValues","next","hasOffer","closeYield","text","len","left","length","PILL_BADGE_CLASS_PREFIX","calcCouponFlags","remainingAvg","flags","fixed","interestFree","getStorageKey","load","json","localStorage","getItem","JSON","parse","save","setItem","stringify","props","computed","moexUrl","this","couponValueText","listLevelBadgeClass","listLevelName","showCouponStar","showCouponHint","rowClass","infoUrl","URL_PREFIX_LIST","URL_PREFIX_OFFSET","Date","now","CACHE_KEY_REPORT","CACHE_KEY_DATE","LAST_DATE","convertFromTextSafe","source","cols","rows","indexOf","i","hasRubCol","date","map","r","coupon","sector","list_level","totalTradesPerc","total_trades_perc","maturity_date","minDaysBetweenAmort","min_days_between_amort","couponMonths","coupon_months","coupon_values","close_yield","has_offer","in_abi","in_cbhy","high_risk","qual","rub","amortRangeDays","amort_range_days","pending","isOFZPK","isOFZ","isOFZIN","type","substring","currentYield","fits","top","convert","error","currentMode","loadResult","KEY","wasScrolled","toggleClass","element","className","active","classList","add","remove","updateMarkup","document","documentElement","window","matchMedia","matches","prefersDark","Number","addEventListener","scrolled","pageYOffset","STORAGE_KEY","TODAY","TODAY_PLUS_1Y","getFullYear","getMonth","TODAY_PLUS_5Y","getMonthText","m","DEFAULT_SETTINGS","min_month","month","min_year","year","sector1","sector2","sector3","govOnly","highRisk","offer","maxListLevel","minRating","minRatingMod","maxPerYear","requiredCouponMonth","couponType","minCurrentYield","minCurrentYieldOther","maxAmort","minTotalTradesPerc","minRatingModApplicable","getMinCurrentYield","settings","applySettings","VM","maturityDateMin","clampYear","maturityDateMax","amortDaysParam","maxAllowedCouponType","requireFixedCoupon","requireConstCoupon","minRatingCombo","totalFits","hasABI","hasCBHY","hasHighRisk","hasQualOnly","hasDownstairs","hasNonFixed","ofzPKUrlAssigned","ofzINUrlAssigned","reportRows","rowCouponFlags","rowCouponIsMonthly","showAll","showClipboardCheck","LAUNCH_TIME","cordova","nightMode","collapseForm","result","storedSettings","storedSettingsOk","keys","onCordovaResume","location","reload","isInput","tagName","clipboardButtonClick","tsvBuilder","tsv","onSuccess","onFailure","alert","exec","navigator","clipboard","writeText","then","style","userSelect","e","target","href","kind","storageKey","confirm","confirmExternalLink","preventDefault","stopPropagation","delta","getBoundingClientRect","innerHeight","scrollBy","behavior","activeElement","passive","ALLOWED_CHARS","fromCharCode","keyCode","filterNumberInputKeys","loadCore","urlIndex","callback","url","isLastUrl","URL_PREFIX_COUNT","xhr","XMLHttpRequest","open","timeout","onreadystatechange","readyState","responseText","report","handleResponseText","send","reportDate","html","reportError","el","data","watch","handler","mode","deep","methods","alertClose","minRatingModVisible","minCurrentYieldThunk","set","setMinCurrentYield","getElementById","display","fontSize","parseFloat","getComputedStyle"],"sourceRoot":""}
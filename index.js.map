{"version":3,"file":"index.js","mappings":"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","sources":["webpack:///./src/bond-row-component.ts","webpack:///./src/coupon-values.ts","webpack:///./src/load-report.ts","webpack:///./src/night-mode.ts","webpack:///./src/report-row-extensions.ts","webpack:///./src/settings.ts","webpack:///./src/storageUtil.ts","webpack:///./src/view-model.ts","webpack:///external var \"{ default: Vue }\"","webpack:///webpack/bootstrap","webpack:///./src/index.ts"],"sourcesContent":["import Vue from \"vue\";\r\nimport { CouponFlags } from \"./coupon-values\";\r\nimport IReportRow from \"./report-row\";\r\nimport { couponHintText, ratingText } from \"./report-row-extensions\";\r\n\r\nconst PILL_BADGE_CLASS_PREFIX = \"badge badge-pill badge-\";\r\n\r\ninterface IContext {\r\n    row: IReportRow;\r\n}\r\n\r\nVue.component(\"bond-row\", {\r\n    props: [ \"row\" ],\r\n    template: \"#bond-row-template\",\r\n    computed: {\r\n\r\n        moexUrl(this: IContext) {\r\n            return \"https://www.moex.com/ru/issue.aspx?code=\" + this.row.isin;\r\n        },\r\n\r\n        ratingText(this: IContext) {\r\n            return ratingText(this.row);\r\n        },\r\n\r\n        couponHintText(this: IContext) {\r\n            return couponHintText(this.row);\r\n        },\r\n\r\n        couponValueText(this: IContext) {\r\n            const row = this.row;\r\n            if (row.couponFlags & CouponFlags.InterestFree) {\r\n                return \"–\";\r\n            }\r\n            return row.couponValues.next;\r\n        },\r\n\r\n        listLevelBadgeClass(this: IContext) {\r\n            const row = this.row;\r\n            switch (row.listLevel) {\r\n                case 1: return PILL_BADGE_CLASS_PREFIX + \"success\";\r\n                case 2: return PILL_BADGE_CLASS_PREFIX + \"warning\";\r\n                case 3: return row.isHighRisk\r\n                    ? PILL_BADGE_CLASS_PREFIX + \"dark bond-finder-ir-badge\"\r\n                    : PILL_BADGE_CLASS_PREFIX + \"danger\";\r\n            }\r\n        },\r\n\r\n        listLevelName(this: IContext) {\r\n            const row = this.row;\r\n            switch (row.listLevel) {\r\n                case 1: return \"I\";\r\n                case 2: return \"II\";\r\n                case 3: return row.isHighRisk\r\n                    ? \"\\xa0\"\r\n                    : \"III\";\r\n            }\r\n        },\r\n\r\n        showCouponStar(this: IContext) {\r\n            return Boolean(this.row.couponFlags & CouponFlags.NonFixed);\r\n        },\r\n\r\n        showCouponHint(this: IContext) {\r\n            return Boolean(this.row.couponFlags & CouponFlags.Downstairs);\r\n        },\r\n\r\n        rowClass(this: IContext) {\r\n            return this.row.infoUrl ? \"bond-finder-separator\" : null;\r\n        }\r\n    }\r\n});\r\n","export interface ICouponValues {\r\n    readonly next: number | null;\r\n    readonly remainingAvg: number | null;\r\n}\r\n\r\nexport const enum CouponFlags {\r\n    Const = 1,\r\n    Downstairs = 2,\r\n    InterestFree = 4,\r\n    NonFixed = 8,\r\n}\r\n\r\nexport function toCouponValues(list: ReadonlyArray<number | null>): ICouponValues {\r\n    const len = list.length;\r\n    const next = len > 0 ? list[0] : 0;\r\n    const remainingAvg = len > 1 ? list[1] : next;\r\n    return { next, remainingAvg };\r\n}\r\n\r\nexport function calcCouponFlags({ next, remainingAvg }: ICouponValues): CouponFlags {\r\n    let flags = 0;\r\n\r\n    const fixed = next != null && remainingAvg != null;\r\n    if (!fixed) {\r\n        flags |= CouponFlags.NonFixed;\r\n    }\r\n\r\n    const interestFree = next === 0 && remainingAvg === 0;\r\n    if (interestFree) {\r\n        flags |= CouponFlags.InterestFree;\r\n    }\r\n\r\n    if (fixed && !interestFree && next === remainingAvg) {\r\n        flags |= CouponFlags.Const;\r\n    }\r\n\r\n    if (fixed && remainingAvg < next) {\r\n        flags |= CouponFlags.Downstairs;\r\n    }\r\n\r\n    return flags;\r\n}\r\n","import { calcCouponFlags, toCouponValues } from \"./coupon-values\";\r\nimport IReportRow from \"./report-row\";\r\nimport storageUtil from \"./storageUtil\";\r\n\r\nconst URL_PREFIX_LIST = [\r\n    \"bond-finder-lab.github.io/backend\",\r\n    \"storage.yandexcloud.net/bond-finder\",\r\n    \"global.s3.cloud.ru/bond-finder\"\r\n] as const;\r\n\r\nconst URL_PREFIX_COUNT = URL_PREFIX_LIST.length;\r\nconst URL_PREFIX_OFFSET = Date.now() % URL_PREFIX_COUNT;\r\n\r\nconst CACHE_KEY_REPORT = \"report-cache-v1\";\r\nconst CACHE_KEY_DATE = \"date\";\r\n\r\nconst LAST_DATE = storageUtil.load(CACHE_KEY_DATE) || \"\";\r\n\r\ninterface IReport {\r\n    readonly date: string;\r\n    readonly rows: ReadonlyArray<IReportRow>;\r\n    readonly error?: boolean;\r\n}\r\n\r\ntype ReportReadyCallback = (report: IReport) => void;\r\n\r\nfunction convert(source: any): IReport {\r\n    const cols = source.cols as readonly string[];\r\n    const rows = source.rows as readonly any[];\r\n\r\n    const indexOf = {} as Record<string, number>;\r\n    for (let i = cols.length - 1; i >= 0; i--) {\r\n        indexOf[cols[i]] = i;\r\n    }\r\n\r\n    const hasRubCol = \"rub\" in indexOf;\r\n\r\n    return {\r\n        date: source.date as string,\r\n        rows: rows.map((r) => {\r\n            const isin = r[indexOf.isin] as string;\r\n            const name = r[indexOf.name] as string;\r\n            const sector = r[indexOf.sector] as number;\r\n            const listLevel = r[indexOf.list_level] as number;\r\n            const totalTradesPerc = r[indexOf.total_trades_perc] as number;\r\n            const maturityDate = r[indexOf.maturity_date] as string;\r\n            const minDaysBetweenAmort = r[indexOf.min_days_between_amort] as number;\r\n            const couponMonths = r[indexOf.coupon_months] as readonly number[];\r\n            const couponValues = toCouponValues(r[indexOf.coupon_values]);\r\n            const closeYield = r[indexOf.close_yield] as number | null;\r\n            const hasOffer = Boolean(r[indexOf.has_offer]);\r\n            const inABI = Boolean(r[indexOf.in_abi]);\r\n            const inCBHY = Boolean(r[indexOf.in_cbhy]);\r\n            const isHighRisk = Boolean(r[indexOf.high_risk]);\r\n            const isQualOnly = Boolean(r[indexOf.qual]);\r\n            const rub = !hasRubCol || Boolean(r[indexOf.rub]);\r\n            const rating = r[indexOf.rating] as number;\r\n            const waprice = r[indexOf.waprice] as number;\r\n            const amortRangeDays = r[indexOf.amort_range_days] as number;\r\n            const pending = Boolean(r[indexOf.pending]);\r\n\r\n            const isOFZPK = isOFZ(\"ПК\");\r\n            const isOFZIN = isOFZ(\"ИН\");\r\n\r\n            function isOFZ(type: string) {\r\n                return sector === 1\r\n                    && name.substring(0, 4) === \"ОФЗ-\"\r\n                    && name.substring(4, 6) === type;\r\n            }\r\n\r\n            function calcCurrentYield() {\r\n                const coupon = couponValues.remainingAvg || couponValues.next;\r\n\r\n                if (coupon && waprice) {\r\n                    return 100 * coupon / waprice;\r\n                }\r\n\r\n                return 0;\r\n            }\r\n\r\n            return {\r\n                isin,\r\n                name,\r\n                sector,\r\n                listLevel,\r\n                totalTradesPerc,\r\n                maturityDate,\r\n                minDaysBetweenAmort,\r\n                couponMonths,\r\n                couponValues,\r\n                closeYield,\r\n                hasOffer,\r\n                inABI,\r\n                inCBHY,\r\n                isHighRisk,\r\n                isQualOnly,\r\n                rub,\r\n                rating,\r\n                waprice,\r\n                amortRangeDays,\r\n                pending,\r\n\r\n                isOFZPK,\r\n                isOFZIN,\r\n                currentYield: calcCurrentYield(),\r\n                couponFlags: calcCouponFlags(couponValues),\r\n                hasFutureAmort: minDaysBetweenAmort > 0, // amortRangeDays is auxiliary\r\n\r\n                fits: false,\r\n                top: false,\r\n                infoUrl: \"\"\r\n            };\r\n        })\r\n    };\r\n}\r\n\r\nfunction convertFromTextSafe(text: string): IReport {\r\n    try {\r\n        return convert(JSON.parse(text));\r\n    } catch {\r\n        return {\r\n            error: true,\r\n            date: \"\",\r\n            rows: [ ]\r\n        };\r\n    }\r\n}\r\n\r\nfunction loadCore(urlIndex: number, callback: ReportReadyCallback) {\r\n    const url = \"https://\"\r\n        + URL_PREFIX_LIST[(URL_PREFIX_OFFSET + urlIndex) % URL_PREFIX_COUNT]\r\n        + \"/report-v1.json?_=\" + Date.now();\r\n\r\n    const isLastUrl = urlIndex === URL_PREFIX_COUNT - 1;\r\n\r\n    const xhr = new XMLHttpRequest();\r\n    xhr.open(\"GET\", url, true);\r\n    xhr.timeout = (isLastUrl ? 10 : 3) * 1000;\r\n\r\n    function handleResponseText(responseText: string) {\r\n        let report = convertFromTextSafe(responseText);\r\n        if (report.error || report.date < LAST_DATE) {\r\n            if (!isLastUrl) {\r\n                loadCore(1 + urlIndex, callback);\r\n                return;\r\n            }\r\n            report = convertFromTextSafe(storageUtil.load(CACHE_KEY_REPORT));\r\n        } else {\r\n            storageUtil.save(CACHE_KEY_REPORT, responseText);\r\n            storageUtil.save(CACHE_KEY_DATE, report.date);\r\n        }\r\n        callback(report);\r\n    }\r\n\r\n    xhr.onreadystatechange = function() {\r\n        if (this.readyState === 4) {\r\n            const { status, responseText } = this;\r\n            handleResponseText(status === 200 ? responseText : \"\");\r\n        }\r\n    };\r\n\r\n    xhr.send();\r\n}\r\n\r\nexport default (callback: ReportReadyCallback) => loadCore(0, callback);\r\n","import storageUtil from \"./storageUtil\";\r\n\r\nconst KEY = \"night\";\r\n\r\nlet currentMode: number;\r\nlet wasScrolled = false;\r\n\r\nfunction prefersDark() {\r\n    try {\r\n        return window.matchMedia && window.matchMedia(\"(prefers-color-scheme: dark)\").matches;\r\n    } catch {\r\n        return false;\r\n    }\r\n}\r\n\r\nfunction loadMode() {\r\n    const loadResult = storageUtil.load(KEY);\r\n    if (loadResult == null) {\r\n        return -1;\r\n    }\r\n    return Number(loadResult);\r\n}\r\n\r\nfunction getMode() {\r\n    return currentMode;\r\n}\r\n\r\nfunction setMode(mode: number) {\r\n    currentMode = mode;\r\n    storageUtil.save(KEY, mode);\r\n    updateMarkup();\r\n}\r\n\r\nfunction isNight() {\r\n    if (currentMode < 0) {\r\n        return prefersDark();\r\n    }\r\n    return currentMode > 0;\r\n}\r\n\r\nfunction toggleClass(element: HTMLElement, className: string, active: boolean) {\r\n    const classList = element.classList;\r\n    if (active) {\r\n        classList.add(className);\r\n    } else {\r\n        classList.remove(className);\r\n    }\r\n}\r\n\r\nfunction updateMarkup() {\r\n    toggleClass(document.documentElement, \"night\", isNight());\r\n}\r\n\r\nfunction onDocScroll() {\r\n    const scrolled = window.pageYOffset > 0;\r\n    if (wasScrolled !== scrolled) {\r\n        toggleClass(document.documentElement, \"scrolled\", scrolled);\r\n        wasScrolled = scrolled;\r\n    }\r\n}\r\n\r\ncurrentMode = loadMode();\r\n\r\ndocument.addEventListener(\"scroll\", onDocScroll, false);\r\n\r\nexport default { getMode, setMode, updateMarkup };\r\n","import { CouponFlags } from \"./coupon-values\";\r\nimport IReportRow from \"./report-row\";\r\n\r\nexport function ratingText(row: IReportRow): string {\r\n    switch (row.rating) {\r\n        case 6: return \"AAA\";\r\n\r\n        case 5.1: return \"AA+\";\r\n        case 5.0: return \"AA\";\r\n        case 4.9: return \"AA-\";\r\n\r\n        case 4.1: return \"A+\";\r\n        case 4.0: return \"A\";\r\n        case 3.9: return \"A-\";\r\n\r\n        case 3.1: return \"BBB+\";\r\n        case 3.0: return \"BBB\";\r\n        case 2.9: return \"BBB-\";\r\n\r\n        case 2.1: return \"BB+\";\r\n        case 2.0: return \"BB\";\r\n        case 1.9: return \"BB-\";\r\n\r\n        case 1.1: return \"B+\";\r\n        case 1.0: return \"B\";\r\n        case 0.9: return \"B-\";\r\n    }\r\n    return \"–\";\r\n}\r\n\r\nexport function couponHintText(row: IReportRow) {\r\n    const { couponFlags } = row;\r\n    if (couponFlags & CouponFlags.Downstairs) {\r\n        return \" ↓\";\r\n    }\r\n    if (couponFlags & CouponFlags.NonFixed) {\r\n        return \"**\";\r\n    }\r\n    return \"\";\r\n}\r\n\r\nconst TSV_LEN_TEXT = 12;\r\nconst TSV_LEN_TAGS = 7;\r\nconst TSV_LEN_LIST_LEVEL = 4;\r\nconst TSV_LEN_RATING = 6;\r\nconst TSV_LEN_DATE = 10;\r\nconst TSV_LEN_NUM = 8;\r\n\r\nexport function toTsvHeader() {\r\n    const cells = [\r\n        pad(\"isin\", TSV_LEN_TEXT),\r\n        pad(\"name\", TSV_LEN_TEXT),\r\n        pad(\"\", TSV_LEN_TAGS),\r\n        pad(\"list\", TSV_LEN_LIST_LEVEL, true),\r\n        pad(\"rating\", TSV_LEN_RATING),\r\n        pad(\"mat_date\", TSV_LEN_DATE),\r\n        \"\",\r\n        pad(\"wa_price\", TSV_LEN_NUM, true),\r\n        \"\",\r\n        pad(\"coupon\", TSV_LEN_NUM, true),\r\n        \"\",\r\n        pad(\"yield\", TSV_LEN_NUM, true)\r\n    ];\r\n    return cells.join(\"\\t\");\r\n}\r\n\r\nexport function toTsvLine(row: IReportRow) {\r\n    const cells = [\r\n        row.isin,\r\n        pad(row.name, TSV_LEN_TEXT),\r\n        tags(),\r\n        pad(String(row.listLevel), TSV_LEN_LIST_LEVEL, true),\r\n        pad(ratingText(row), TSV_LEN_RATING),\r\n        row.maturityDate,\r\n        row.hasFutureAmort ? \"A\" : \"\",\r\n        numeric(row.waprice),\r\n        couponHintText(row),\r\n        numeric(row.couponValues.next),\r\n        row.hasOffer ? \"оф\" : \"\",\r\n        numeric(row.closeYield)\r\n    ];\r\n\r\n    function tags(): string {\r\n        const list: string[] = [ ];\r\n\r\n        if (row.isQualOnly) {\r\n            list.push(\"кв\");\r\n        } else if (row.inABI) {\r\n            list.push(\"*\");\r\n        } else if (row.inCBHY) {\r\n            list.push(\"вд\");\r\n        }\r\n\r\n        if (row.isHighRisk) {\r\n            list.push(\"пир\");\r\n        }\r\n\r\n        return pad(list.join(\", \"), TSV_LEN_TAGS);\r\n    }\r\n\r\n    function numeric(value: number | null): string {\r\n        const text = value == null ? \"\" : String(value);\r\n        return pad(text, TSV_LEN_NUM, true);\r\n    }\r\n\r\n    return cells.join(\"\\t\");\r\n}\r\n\r\nfunction pad(text: string, len: number, left = false): string {\r\n    while (text.length < len) {\r\n        if (left) {\r\n            text = \" \" + text;\r\n        } else {\r\n            text = text + \" \";\r\n        }\r\n    }\r\n    return text;\r\n}\r\n","import storageUtil from \"./storageUtil\";\r\n\r\nconst STORAGE_KEY = \"settings-v1\";\r\n\r\nexport interface ISettings {\r\n    rub: boolean;\r\n    min_month: string;\r\n    min_year: string;\r\n    month: string;\r\n    year: string;\r\n    sector1: boolean;\r\n    sector2: boolean;\r\n    sector3: boolean;\r\n    govOnly: boolean;\r\n    highRisk: boolean;\r\n    qual: boolean;\r\n    offer: boolean;\r\n    maxListLevel: string;\r\n    minRating: string;\r\n    minRatingMod: string;\r\n    maxPerYear: string;\r\n    requiredCouponMonth: string;\r\n    couponType: string;\r\n    minCurrentYield: string;\r\n    minCurrentYieldOther: string;\r\n    maxAmort: string;\r\n    minTotalTradesPerc: string;\r\n}\r\n\r\nconst TODAY = new Date();\r\nconst TODAY_PLUS_1Y = new Date(TODAY.getFullYear() + 1, TODAY.getMonth(), 1);\r\nconst TODAY_PLUS_5Y = new Date(TODAY.getFullYear() + 5, TODAY.getMonth(), 1);\r\n\r\nfunction getMonthText(date: Date): string {\r\n    const m = 1 + date.getMonth();\r\n    return m > 9 ? String(m) : (\"0\" + m);\r\n}\r\n\r\nconst DEFAULT_SETTINGS: ISettings = {\r\n    rub: true,\r\n    min_month: getMonthText(TODAY_PLUS_1Y),\r\n    month: getMonthText(TODAY_PLUS_5Y),\r\n    min_year: String(TODAY_PLUS_1Y.getFullYear()),\r\n    year: String(TODAY_PLUS_5Y.getFullYear()),\r\n    sector1: true,\r\n    sector2: true,\r\n    sector3: true,\r\n    govOnly: false,\r\n    highRisk: false,\r\n    qual: false,\r\n    offer: false,\r\n    maxListLevel: \"2\",\r\n    minRating: \"4\",\r\n    minRatingMod: \"-0.1\",\r\n    maxPerYear: \"-1\",\r\n    requiredCouponMonth: \"0\",\r\n    couponType: \"0\",\r\n    minCurrentYield: \"\",\r\n    minCurrentYieldOther: \"\",\r\n    maxAmort: \"90\",\r\n    minTotalTradesPerc: \"50\"\r\n};\r\n\r\nexport function load(): ISettings {\r\n    const result = { ...DEFAULT_SETTINGS };\r\n    const storedSettings = storageUtil.load(STORAGE_KEY, true) as Readonly<any>;\r\n\r\n    if (storedSettings && typeof storedSettings === \"object\") {\r\n        for (const key of Object.keys(DEFAULT_SETTINGS)) {\r\n            if (key in storedSettings) {\r\n                result[key] = storedSettings[key];\r\n            }\r\n        }\r\n    }\r\n\r\n    if (result.couponType === \"3\") {\r\n        result.couponType = \"2\";\r\n        result.offer = true;\r\n    }\r\n\r\n    return result;\r\n}\r\n\r\nexport function save(settings: ISettings) {\r\n    storageUtil.save(STORAGE_KEY, settings, true);\r\n}\r\n\r\nexport function minRatingModApplicable(minRating: number) {\r\n    return minRating > 0 && minRating < 6;\r\n}\r\n\r\nexport function getMinCurrentYield(settings: ISettings): string {\r\n    return settings.rub\r\n        ? settings.minCurrentYield\r\n        : settings.minCurrentYieldOther;\r\n}\r\n\r\nexport function setMinCurrentYield(settings: ISettings, value: string): void {\r\n    if (settings.rub) {\r\n        settings.minCurrentYield = value;\r\n    } else {\r\n        settings.minCurrentYieldOther = value;\r\n    }\r\n}\r\n","function getStorageKey(key: string) {\r\n    return \"bond-finder-\" + key;\r\n}\r\n\r\nfunction load(key: string, json = false) {\r\n    try {\r\n        const value = localStorage.getItem(getStorageKey(key));\r\n        return json && value != null ? JSON.parse(value) : value;\r\n    } catch {\r\n        return null;\r\n    }\r\n}\r\n\r\nfunction save(key: string, value: any, json = false) {\r\n    try {\r\n        localStorage.setItem(\r\n            getStorageKey(key),\r\n            (json ? JSON.stringify : String)(value)\r\n        );\r\n    } catch {\r\n        // mute\r\n    }\r\n}\r\n\r\nexport default { load, save };\r\n","import { CouponFlags } from \"./coupon-values\";\r\nimport IReportRow from \"./report-row\";\r\nimport { ISettings, minRatingModApplicable, save as saveSettings } from \"./settings\";\r\nimport { getMinCurrentYield } from \"./settings\";\r\n\r\nexport interface IViewModel {\r\n    nightMode: number;\r\n    settings: ISettings;\r\n    reportDate?: string;\r\n    reportRows: ReadonlyArray<IReportRow>;\r\n    reportError?: boolean;\r\n    totalFits?: number;\r\n    showAll?: boolean;\r\n    hasABI?: boolean;\r\n    hasCBHY?: boolean;\r\n    hasHighRisk?: boolean;\r\n    hasQualOnly?: boolean;\r\n    hasDownstairs?: boolean;\r\n    hasNonFixed?: boolean;\r\n    hasOffer?: boolean;\r\n    collapseForm?: boolean;\r\n    hasFutureAmort?: boolean;\r\n    showClipboardCheck?: boolean;\r\n    // showAlert?: boolean;\r\n}\r\n\r\nexport function applySettings(VM: IViewModel) {\r\n    saveSettings(VM.settings);\r\n\r\n    const settings = VM.settings;\r\n    const rub = settings.rub;\r\n    const maturityDateMin = [ clampYear(settings.min_year), settings.min_month, \"01\" ].join(\"-\");\r\n    const maturityDateMax = [ clampYear(settings.year), settings.month, \"31\" ].join(\"-\");\r\n    const maxListLevel = Number(settings.maxListLevel);\r\n    const minRating = Number(settings.minRating);\r\n    const minRatingMod = Number(settings.minRatingMod);\r\n    const maxPerYear = Number(settings.maxPerYear);\r\n    const requiredCouponMonth = Number(settings.requiredCouponMonth);\r\n    const amortDaysParam = Number(settings.maxAmort);\r\n    const minTotalTradesPerc = Number(settings.minTotalTradesPerc);\r\n    const minCurrentYield = Number(getMinCurrentYield(settings));\r\n\r\n    const maxAllowedCouponType = Number(settings.couponType);\r\n    const requireFixedCoupon = maxAllowedCouponType < 2;\r\n    const requireConstCoupon = maxAllowedCouponType < 1;\r\n\r\n    const minRatingCombo = minRatingModApplicable(minRating) ? (minRating + minRatingMod) : minRating;\r\n\r\n    const TOP = 20;\r\n    const MAX = 1000;\r\n\r\n    let totalFits = 0;\r\n    let hasABI = false;\r\n    let hasCBHY = false;\r\n    let hasHighRisk = false;\r\n    let hasQualOnly = false;\r\n    let hasDownstairs = false;\r\n    let hasNonFixed = false;\r\n    let hasOffer = false;\r\n    let hasFutureAmort = false;\r\n\r\n    let ofzPKUrlAssigned = false;\r\n    let ofzINUrlAssigned = false;\r\n\r\n    for (const row of VM.reportRows) {\r\n        if (totalFits < MAX && fits(row)) {\r\n            const { couponFlags } = row;\r\n            totalFits++;\r\n            row.fits = true;\r\n            row.top = totalFits <= TOP;\r\n            hasFutureAmort = hasFutureAmort || row.hasFutureAmort;\r\n            hasABI = hasABI || row.inABI;\r\n            hasCBHY = hasCBHY || row.inCBHY;\r\n            hasHighRisk = hasHighRisk || row.isHighRisk;\r\n            hasQualOnly = hasQualOnly || row.isQualOnly;\r\n            hasDownstairs = hasDownstairs || Boolean(couponFlags & CouponFlags.Downstairs);\r\n            hasNonFixed = hasNonFixed || Boolean(couponFlags & CouponFlags.NonFixed);\r\n            hasOffer = hasOffer || row.hasOffer;\r\n\r\n            row.infoUrl = \"\";\r\n            if (!row.closeYield) {\r\n                if (!ofzPKUrlAssigned && row.isOFZPK) {\r\n                    ofzPKUrlAssigned = true;\r\n                    row.infoUrl = \"https://bcs-express.ru/novosti-i-analitika/ofz-pk-s-priviazkoi-k-ruonia-kak-zashchitit-sredstva-ot-infliatsii\";\r\n                } else if (!ofzINUrlAssigned && row.isOFZIN) {\r\n                    ofzINUrlAssigned = true;\r\n                    row.infoUrl = \"https://bcs-express.ru/novosti-i-analitika/ofz-in-ili-kak-garantirovano-zashchitit-sebia-ot-infliatsii\";\r\n                }\r\n            }\r\n        } else {\r\n            row.fits = row.top = false;\r\n        }\r\n    }\r\n\r\n    VM.totalFits = totalFits;\r\n    VM.showAll = totalFits / TOP < 1.5;\r\n    VM.hasABI = hasABI;\r\n    VM.hasCBHY = hasCBHY;\r\n    VM.hasHighRisk = hasHighRisk;\r\n    VM.hasQualOnly = hasQualOnly;\r\n    VM.hasDownstairs = hasDownstairs;\r\n    VM.hasNonFixed = hasNonFixed;\r\n    VM.hasOffer = hasOffer;\r\n    VM.hasFutureAmort = hasFutureAmort;\r\n    VM.showClipboardCheck = false;\r\n\r\n    function fits(row: IReportRow) {\r\n        if (row.pending) {\r\n            return false;\r\n        }\r\n\r\n        if (row.rub !== rub) {\r\n            return false;\r\n        }\r\n\r\n        if (row.isHighRisk && !settings.highRisk) {\r\n            return false;\r\n        }\r\n\r\n        if (row.isQualOnly && !settings.qual) {\r\n            return false;\r\n        }\r\n\r\n        if (row.hasOffer && !settings.offer) {\r\n            return false;\r\n        }\r\n\r\n        if (row.listLevel > maxListLevel) {\r\n            return false;\r\n        }\r\n\r\n        if (row.rating < minRatingCombo) {\r\n            return false;\r\n        }\r\n\r\n        const rowCouponFlags = row.couponFlags;\r\n\r\n        if (requireFixedCoupon && (rowCouponFlags & CouponFlags.NonFixed)) {\r\n            return false;\r\n        }\r\n\r\n        if (requireConstCoupon && !(rowCouponFlags & CouponFlags.Const)) {\r\n            return false;\r\n        }\r\n\r\n        if (minCurrentYield > 0 && row.currentYield < minCurrentYield) {\r\n            return false;\r\n        }\r\n\r\n        if (row.totalTradesPerc < minTotalTradesPerc) {\r\n            return false;\r\n        }\r\n\r\n        if (row.maturityDate < maturityDateMin || row.maturityDate > maturityDateMax) {\r\n            return false;\r\n        }\r\n\r\n        if (rub) {\r\n            if (settings.sector1 || settings.sector2 || settings.sector3) {\r\n                if (row.sector === 1 && !settings.sector1) { return false; }\r\n                if (row.sector === 2 && !settings.sector2) { return false; }\r\n                if (row.sector === 3 && !settings.sector3) { return false; }\r\n            }\r\n        } else {\r\n            if (settings.govOnly && row.sector !== 1) { return false; }\r\n        }\r\n\r\n        const rowCouponIsMonthly = row.couponMonths[0] === -12;\r\n\r\n        if (maxPerYear > -1) {\r\n            if (rowCouponIsMonthly) {\r\n                return false;\r\n            }\r\n            if (row.couponMonths.length > maxPerYear) {\r\n                return false;\r\n            }\r\n        }\r\n\r\n        if (maxPerYear === -12 && !rowCouponIsMonthly) {\r\n            return false;\r\n        }\r\n\r\n        if (requiredCouponMonth > 0 && !rowCouponIsMonthly) {\r\n            if (row.couponMonths.indexOf(requiredCouponMonth) < 0) {\r\n                return false;\r\n            }\r\n        }\r\n\r\n        if (row.hasFutureAmort) {\r\n            if (amortDaysParam === -1) {\r\n                return false;\r\n            }\r\n            if (amortDaysParam > 0) {\r\n                if (row.minDaysBetweenAmort < amortDaysParam) {\r\n                    return false;\r\n                }\r\n            }\r\n            if (amortDaysParam < -1) {\r\n                if (row.amortRangeDays > -amortDaysParam) {\r\n                    return false;\r\n                }\r\n            }\r\n        }\r\n\r\n        return true;\r\n    }\r\n}\r\n\r\nfunction clampYear(year: string): string {\r\n    if (year.length < 4) {\r\n        return \"2000\";\r\n    }\r\n    if (year.length > 4) {\r\n        return \"3000\";\r\n    }\r\n    return year;\r\n}\r\n","module.exports = { default: Vue };","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","import Vue from \"vue\";\r\nimport \"./bond-row-component\";\r\nimport loadReport from \"./load-report\";\r\nimport nightMode from \"./night-mode\";\r\nimport { toTsvHeader, toTsvLine } from \"./report-row-extensions\";\r\nimport { load as loadSettings, minRatingModApplicable } from \"./settings\";\r\nimport { getMinCurrentYield, setMinCurrentYield } from \"./settings\";\r\nimport storageUtil from \"./storageUtil\";\r\nimport { applySettings, IViewModel } from \"./view-model\";\r\n\r\nconst LAUNCH_TIME = Date.now();\r\nconst ROOT_ID = \"vue-root\";\r\nconst cordova = (window as any).cordova;\r\nconst ALERT_DISMISS_KEY = \"alert-v1\";\r\n\r\nconst VM: IViewModel = {\r\n    nightMode: nightMode.getMode(),\r\n    collapseForm: window.matchMedia && window.matchMedia(\"(max-width: 992px)\").matches,\r\n    settings: loadSettings(),\r\n    reportRows: [ ]\r\n};\r\n\r\nnightMode.updateMarkup();\r\n\r\nif (cordova) {\r\n    document.addEventListener(\"deviceready\", onCordovaReady, false);\r\n    document.addEventListener(\"deviceconfigchange\", onCordovaConfigChange, false);\r\n    document.documentElement.style.userSelect = \"none\";\r\n    trackExternalLinks();\r\n    ensureFocusedInputVisible();\r\n} else {\r\n    disableFocusedInputWheel();\r\n    filterNumberInputKeys();\r\n}\r\n\r\nloadReport((report) => {\r\n    VM.reportDate = report.date;\r\n    VM.reportRows = report.rows;\r\n\r\n    const reportError = report.error;\r\n    VM.reportError = reportError;\r\n    // VM.showAlert = !reportError && !storageUtil.load(ALERT_DISMISS_KEY);\r\n\r\n    applySettings(VM);\r\n\r\n    new Vue({\r\n        el: \"#\" + ROOT_ID,\r\n        data: VM,\r\n        watch: {\r\n            nightMode: {\r\n                handler: (value) => nightMode.setMode(value)\r\n            },\r\n            settings: {\r\n                deep: true,\r\n                handler: () => applySettings(VM)\r\n            }\r\n        },\r\n        methods: {\r\n            alertClose: () => storageUtil.save(ALERT_DISMISS_KEY, true),\r\n            clipboardButtonClick\r\n        },\r\n        computed: {\r\n            minRatingModVisible() {\r\n                return minRatingModApplicable(Number(this.settings.minRating));\r\n            },\r\n            minCurrentYieldThunk: {\r\n                get() {\r\n                    return getMinCurrentYield(this.settings);\r\n                },\r\n                set(value: string) {\r\n                    setMinCurrentYield(this.settings, value);\r\n                }\r\n            }\r\n        }\r\n    });\r\n\r\n    document.getElementById(ROOT_ID)!.style.display = \"\";\r\n    document.getElementById(\"bond-finder-loading\")!.style.display = \"none\";\r\n\r\n    if (!cordova) {\r\n        initFontSize();\r\n    }\r\n});\r\n\r\nfunction onCordovaReady() {\r\n    document.addEventListener(\"resume\", onCordovaResume, false);\r\n}\r\n\r\nfunction onCordovaResume() {\r\n    if (Date.now() - LAUNCH_TIME > 1234 * 1000) {\r\n        location.reload();\r\n    }\r\n}\r\n\r\nfunction onCordovaConfigChange() {\r\n    nightMode.updateMarkup();\r\n}\r\n\r\nfunction initFontSize() {\r\n    const html = document.documentElement;\r\n    html.style.fontSize = \"medium\";\r\n    html.style.fontSize = 1600 / parseFloat(getComputedStyle(html).fontSize) + \"%\";\r\n}\r\n\r\nfunction trackExternalLinks() {\r\n    document.addEventListener(\"click\", (e) => {\r\n        const a = e.target as HTMLAnchorElement;\r\n        if (a.tagName === \"A\" && !confirmExternalLink(a.href)) {\r\n            e.preventDefault();\r\n            e.stopPropagation();\r\n        }\r\n    }, false);\r\n}\r\n\r\nfunction ensureFocusedInputVisible() {\r\n    document.addEventListener(\"click\", (e) => {\r\n        const element = e.target as HTMLElement;\r\n        if (isInput(element)) {\r\n            const { bottom } = element.getBoundingClientRect();\r\n            const delta = bottom - innerHeight / 2;\r\n            if (delta > 0) {\r\n                try {\r\n                    scrollBy({ behavior: \"smooth\", top: delta });\r\n                } catch {\r\n                    scrollBy(0, delta);\r\n                }\r\n            }\r\n        }\r\n    }, false);\r\n}\r\n\r\nfunction disableFocusedInputWheel() {\r\n    function handler(e: WheelEvent) {\r\n        const element = e.target as HTMLElement;\r\n        if (document.activeElement === element && isInput(element)) {\r\n            e.preventDefault();\r\n        }\r\n    }\r\n    document.addEventListener(\"wheel\", handler, { passive: false });\r\n}\r\n\r\nfunction filterNumberInputKeys() {\r\n    const ALLOWED_CHARS = {\r\n        \".\": true,\r\n        \"-\": true\r\n    };\r\n\r\n    for (let i = 0; i < 10; i++) {\r\n        ALLOWED_CHARS[i] = true;\r\n    }\r\n\r\n    function handler(e: KeyboardEvent) {\r\n        const element = e.target as HTMLInputElement;\r\n        if (isInput(element) && element.type === \"number\") {\r\n            const key = e.key || String.fromCharCode(e.keyCode);\r\n            if (!ALLOWED_CHARS[key]) {\r\n                e.preventDefault();\r\n            }\r\n        }\r\n    }\r\n\r\n    document.addEventListener(\"keypress\", handler, { passive: false });\r\n}\r\n\r\nfunction isInput(element: HTMLElement) {\r\n    return element.tagName === \"INPUT\";\r\n}\r\n\r\nfunction confirmExternalLink(href: string) {\r\n    if (!href) {\r\n        return true;\r\n    }\r\n\r\n    const kind = href.indexOf(\"moex.com/\") > -1 ? \"moex\" : \"other\";\r\n    const storageKey = \"confirm-external-link-\" + kind;\r\n\r\n    if (!storageUtil.load(storageKey)) {\r\n        const subj = kind === \"moex\"\r\n            ? \"сайт Московской Биржи\"\r\n            : \"внешний сайт\";\r\n        if (!confirm(\"Пожалуйста, подтвердите переход на \" + subj)) {\r\n            return false;\r\n        }\r\n        storageUtil.save(storageKey, \"1\");\r\n    }\r\n\r\n    return true;\r\n}\r\n\r\nfunction clipboardButtonClick() {\r\n    const tsvBuilder = [ toTsvHeader() ];\r\n    for (const r of VM.reportRows) {\r\n        if (r.fits) {\r\n            tsvBuilder.push(toTsvLine(r));\r\n        }\r\n    }\r\n\r\n    const tsv = tsvBuilder.join(\"\\n\");\r\n\r\n    function onSuccess() {\r\n        if (!cordova) {\r\n            VM.showClipboardCheck = true;\r\n        }\r\n    }\r\n\r\n    function onFailure() {\r\n        alert(\"Не получилось\");\r\n    }\r\n\r\n    if (cordova) {\r\n        cordova.exec(onSuccess, onFailure, \"CordovaPluginUtils\", \"clipboardWrite\", [ tsv ]);\r\n    } else {\r\n        try {\r\n            navigator.clipboard.writeText(tsv).then(onSuccess, onFailure);\r\n        } catch {\r\n            onFailure();\r\n        }\r\n    }\r\n}\r\n"],"names":["PILL_BADGE_CLASS_PREFIX","component","props","template","computed","moexUrl","this","row","isin","ratingText","couponHintText","couponValueText","couponFlags","couponValues","next","listLevelBadgeClass","listLevel","isHighRisk","listLevelName","showCouponStar","showCouponHint","rowClass","infoUrl","list","len","length","remainingAvg","flags","fixed","interestFree","URL_PREFIX_LIST","URL_PREFIX_OFFSET","Date","now","CACHE_KEY_REPORT","CACHE_KEY_DATE","LAST_DATE","load","convertFromTextSafe","text","source","cols","rows","indexOf","i","hasRubCol","date","map","r","coupon","name","sector","list_level","totalTradesPerc","total_trades_perc","maturityDate","maturity_date","minDaysBetweenAmort","min_days_between_amort","couponMonths","coupon_months","toCouponValues","coupon_values","closeYield","close_yield","hasOffer","has_offer","inABI","in_abi","inCBHY","in_cbhy","high_risk","isQualOnly","qual","rub","rating","waprice","amortRangeDays","amort_range_days","pending","isOFZPK","isOFZ","isOFZIN","type","substring","currentYield","calcCouponFlags","hasFutureAmort","fits","top","convert","JSON","parse","error","loadCore","urlIndex","callback","url","isLastUrl","URL_PREFIX_COUNT","xhr","XMLHttpRequest","open","timeout","onreadystatechange","readyState","responseText","report","save","handleResponseText","send","currentMode","loadResult","KEY","wasScrolled","toggleClass","element","className","active","classList","add","remove","updateMarkup","document","documentElement","window","matchMedia","matches","prefersDark","Number","addEventListener","scrolled","pageYOffset","getMode","setMode","mode","pad","left","join","numeric","value","String","push","STORAGE_KEY","TODAY","TODAY_PLUS_1Y","getFullYear","getMonth","TODAY_PLUS_5Y","getMonthText","m","DEFAULT_SETTINGS","min_month","month","min_year","year","sector1","sector2","sector3","govOnly","highRisk","offer","maxListLevel","minRating","minRatingMod","maxPerYear","requiredCouponMonth","couponType","minCurrentYield","minCurrentYieldOther","maxAmort","minTotalTradesPerc","result","storedSettings","Object","keys","key","settings","getStorageKey","json","localStorage","getItem","setItem","stringify","clampYear","VM","maturityDateMin","maturityDateMax","amortDaysParam","getMinCurrentYield","maxAllowedCouponType","requireFixedCoupon","requireConstCoupon","minRatingCombo","minRatingModApplicable","totalFits","hasABI","hasCBHY","hasHighRisk","hasQualOnly","hasDownstairs","hasNonFixed","ofzPKUrlAssigned","ofzINUrlAssigned","reportRows","rowCouponFlags","rowCouponIsMonthly","showAll","showClipboardCheck","module","exports","default","Vue","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","undefined","__webpack_modules__","call","LAUNCH_TIME","ROOT_ID","cordova","nightMode","collapseForm","onCordovaResume","location","reload","isInput","tagName","clipboardButtonClick","tsvBuilder","toTsvHeader","toTsvLine","tsv","onSuccess","onFailure","alert","exec","navigator","clipboard","writeText","then","style","userSelect","e","a","target","href","kind","storageKey","confirm","confirmExternalLink","preventDefault","stopPropagation","delta","getBoundingClientRect","innerHeight","scrollBy","behavior","activeElement","passive","ALLOWED_CHARS","fromCharCode","keyCode","filterNumberInputKeys","reportDate","html","reportError","applySettings","el","data","watch","handler","deep","methods","alertClose","minRatingModVisible","minCurrentYieldThunk","get","set","setMinCurrentYield","getElementById","display","fontSize","parseFloat","getComputedStyle"],"sourceRoot":""}